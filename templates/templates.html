<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£Ÿç‰©æ¨¡æ¿ - é¥®é£Ÿè¿½è¸ªå™¨</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .navbar {
            background-color: #4ECDC4;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-links {
            display: flex;
            gap: 15px;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 15px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .nav-links a:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .logo {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .card-title {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: #333;
            border-bottom: 2px solid #4ECDC4;
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .btn {
            display: inline-block;
            background-color: #4ECDC4;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #3CA299;
        }
        
        .btn-secondary {
            background-color: #6c757d;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .btn-danger {
            background-color: #dc3545;
        }
        
        .btn-danger:hover {
            background-color: #c82333;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 0.8rem;
        }
        
        .flash-messages {
            margin-bottom: 20px;
        }
        
        .alert {
            padding: 12px 15px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .template-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .template-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .template-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .template-ratios {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .ratio-item {
            text-align: center;
            flex: 1;
        }
        
        .ratio-value {
            font-size: 1.3rem;
            font-weight: bold;
            display: block;
        }
        
        .ratio-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .carb-color { color: #4ECDC4; }
        .protein-color { color: #45B7AF; }
        .fat-color { color: #3CA299; }
        
        .template-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
            grid-column: 1 / -1;
        }
        
        .empty-icon {
            font-size: 3rem;
            margin-bottom: 20px;
        }
        
        .search-box {
            margin-bottom: 20px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .template-meta {
            font-size: 0.8rem;
            color: #999;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #eee;
        }
        
        @media (max-width: 600px) {
            .navbar {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-links {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .templates-grid {
                grid-template-columns: 1fr;
            }
            
            .template-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="logo">ğŸ½ï¸ é¥®é£Ÿè¿½è¸ªå™¨</div>
        <div class="nav-links">
            <a href="/">ä»Šæ—¥ä»ªè¡¨ç›˜</a>
            <a href="/add_record">æ·»åŠ è®°å½•</a>
            <a href="/templates" style="background-color: rgba(255, 255, 255, 0.2);">é£Ÿç‰©æ¨¡æ¿</a>
            <a href="/history">å†å²è®°å½•</a>
            <a href="/config">ä¸ªäººè®¾ç½®</a>
        </div>
    </nav>
    
    <!-- é—ªå­˜æ¶ˆæ¯ -->
    <div class="flash-messages">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category if category != 'error' else 'error' }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>
    
    <div class="card">
        <div class="card-title">
            <span>é£Ÿç‰©æ¨¡æ¿ ({{ templates|length }}ä¸ª)</span>
            <a href="/add_template" class="btn">+ æ·»åŠ æ–°æ¨¡æ¿</a>
        </div>
        
        <div class="search-box">
            <input type="text" id="searchInput" class="search-input" 
                   placeholder="æœç´¢æ¨¡æ¿åç§°...">
        </div>
        
        {% if templates %}
        <div class="templates-grid" id="templatesContainer">
            {% for template in templates %}
            <div class="template-card" data-name="{{ template.name.lower() }}">
                <div class="template-name">{{ template.name }}</div>
                
                <div class="template-ratios">
                    <div class="ratio-item">
                        <span class="ratio-value carb-color">{{ template.carb_ratio }}%</span>
                        <span class="ratio-label">ç¢³æ°´</span>
                    </div>
                    <div class="ratio-item">
                        <span class="ratio-value protein-color">{{ template.protein_ratio }}%</span>
                        <span class="ratio-label">è›‹ç™½</span>
                    </div>
                    <div class="ratio-item">
                        <span class="ratio-value fat-color">{{ template.fat_ratio }}%</span>
                        <span class="ratio-label">è„‚è‚ª</span>
                    </div>
                </div>
                
                {% if template.calories %}
                <div style="text-align: center; margin: 10px 0;">
                    <span style="font-size: 0.9rem; color: #666;">çƒ­é‡: {{ template.calories }} åƒå¡/å…‹</span>
                </div>
                {% endif %}
                
                <div class="template-meta">
                    åˆ›å»ºæ—¶é—´: {{ template.created_at.strftime('%Y-%m-%d') if template.created_at else 'æœªçŸ¥' }}
                </div>
                
                <div class="template-actions">
                    <a href="/add_record?template_id={{ template.id }}" class="btn btn-small">ä½¿ç”¨</a>
                    <a href="/edit_template/{{ template.id }}" class="btn btn-small btn-secondary">ç¼–è¾‘</a>
                    <a href="/delete_template/{{ template.id }}" class="btn btn-small btn-danger" 
                       onclick="return confirm('ç¡®å®šè¦åˆ é™¤æ¨¡æ¿"{{ template.name }}"å—ï¼Ÿ')">åˆ é™¤</a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">ğŸ“‹</div>
            <h3>è¿˜æ²¡æœ‰é£Ÿç‰©æ¨¡æ¿</h3>
            <p>æ¨¡æ¿å¯ä»¥å¸®åŠ©æ‚¨å¿«é€Ÿæ·»åŠ å¸¸åƒçš„é£Ÿç‰©ï¼Œæ— éœ€é‡å¤è¾“å…¥è¥å…»æ¯”ä¾‹</p>
            <a href="/add_template" class="btn" style="margin-top: 20px;">åˆ›å»ºç¬¬ä¸€ä¸ªæ¨¡æ¿</a>
        </div>
        {% endif %}
    </div>
    
    <script>
        // æœç´¢åŠŸèƒ½
        document.getElementById('searchInput').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const templateCards = document.querySelectorAll('.template-card');
            
            templateCards.forEach(card => {
                const templateName = card.getAttribute('data-name');
                if (templateName.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });
        
        // æŒ‰Enteré”®å¿«é€Ÿä½¿ç”¨ç¬¬ä¸€ä¸ªæ¨¡æ¿
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && document.activeElement.id === 'searchInput') {
                const firstVisibleCard = document.querySelector('.template-card[style="display: block;"]');
                if (firstVisibleCard) {
                    const useBtn = firstVisibleCard.querySelector('a[href*="/add_record"]');
                    if (useBtn) {
                        window.location.href = useBtn.href;
                    }
                }
            }
        });
    </script>
</body>
</html>